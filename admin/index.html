<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CRUD Video Bootstrap</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
  <h1 class="mb-4 text-center">CRUD Video</h1>

  <!-- Form Video -->
  <div class="card shadow mb-4">
    <div class="card-body">
      <form id="videoForm" class="row g-3">
        <input type="hidden" id="videoId">
        <div class="col-md-4">
          <label for="title" class="form-label">Judul Video</label>
          <input type="text" id="title" class="form-control" placeholder="Masukkan judul" required>
        </div>
        <div class="col-md-4">
          <label for="url" class="form-label">URL Video</label>
          <input type="text" id="url" class="form-control" placeholder="Link video (mp4)" required>
        </div>
        <div class="col-md-4">
          <label for="description" class="form-label">Deskripsi</label>
          <input type="text" id="description" class="form-control" placeholder="Deskripsi singkat">
        </div>
        <div class="col-12 text-end">
          <button type="submit" class="btn btn-primary">Simpan</button>
          <button type="reset" class="btn btn-secondary">Reset</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Daftar Video -->
  <div class="row" id="videoList"></div>
</div>

<script>
  const API_URL = "http://localhost:3000/videos";
  const form = document.getElementById("videoForm");
  const videoList = document.getElementById("videoList");
  const titleInput = document.getElementById("title");
  const urlInput = document.getElementById("url");
  const descInput = document.getElementById("description");
  const idInput = document.getElementById("videoId");

  async function loadVideos() {
    const res = await fetch(API_URL);
    const data = await res.json();
    videoList.innerHTML = "";
    data.forEach(video => {
      const col = document.createElement("div");
      col.className = "col-md-4 mb-4";

      const card = document.createElement("div");
      card.className = "card shadow-sm h-100";

      const videoElement = document.createElement("video");
      videoElement.src = video.url;
      videoElement.controls = true;
      videoElement.className = "card-img-top";

      const body = document.createElement("div");
      body.className = "card-body";

      const title = document.createElement("h5");
      title.className = "card-title";
      title.textContent = video.title;

      const desc = document.createElement("p");
      desc.className = "card-text";
      desc.textContent = video.description || "-";

      const editBtn = document.createElement("button");
      editBtn.className = "btn btn-sm btn-warning me-2";
      editBtn.textContent = "Edit";
      editBtn.onclick = () => {
        idInput.value = video.id;
        titleInput.value = video.title;
        urlInput.value = video.url;
        descInput.value = video.description;
      };

      const delBtn = document.createElement("button");
      delBtn.className = "btn btn-sm btn-danger";
      delBtn.textContent = "Hapus";
      delBtn.onclick = async () => {
        await fetch(`${API_URL}/${video.id}`, { method: "DELETE" });
        loadVideos();
      };

      body.appendChild(title);
      body.appendChild(desc);
      body.append(editBtn, delBtn);
      card.appendChild(videoElement);
      card.appendChild(body);
      col.appendChild(card);
      videoList.appendChild(col);
    });
  }

  form.onsubmit = async (e) => {
    e.preventDefault();
    const id = idInput.value;
    const payload = {
      title: titleInput.value,
      url: urlInput.value,
      description: descInput.value
    };

    if (id) {
      await fetch(`${API_URL}/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
    } else {
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
    }

    form.reset();
    loadVideos();
  };

  loadVideos();
</script>

</body>
</html>
